version: '3'
services:
    zipkin:
        image: openzipkin/zipkin
        ports:
            - "9411:9411"
        networks:
            - spring-cloud-network
        deploy:
            resources:
                limits:
                    memory: 512M

    graphite:
        image: graphiteapp/graphite-statsd
        ports:
            - "2003:2003"
        networks:
            - spring-cloud-network
        deploy:
            resources:
                limits:
                    memory: 512M

    discovery:
        build: ./platform-services/discovery/target/
        ports:
            - "8761:8761"
        networks:
            - spring-cloud-network
        deploy:
            resources:
                limits:
                    memory: 512M

    apigateway:
        build: ./platform-services/apigateway/target/
        ports:
            - "8765:8765"
        links:
            - discovery
        networks:
            - spring-cloud-network
        deploy:
            resources:
                limits:
                    memory: 512M

    one:
        build: ./business-services/one/target/
        environment:
            debug: true
        links:
            - zipkin
            - graphite
            - discovery
        networks:
            - spring-cloud-network
        deploy:
            resources:
                limits:
                    memory: 512M

    two:
        build: ./business-services/two/target/
        links:
            - zipkin
            - graphite
            - discovery
        networks:
            - spring-cloud-network
        deploy:
            resources:
                limits:
                    memory: 512M

networks:
    spring-cloud-network:
        driver: bridge